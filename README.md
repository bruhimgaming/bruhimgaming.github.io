# Google reCAPTCHA

This repository contains a sample code using Google's reCAPTCHA.

Using reCAPTCHA is quite simple:

- Include reCAPTCHA script in your webpage
- Tag a button with reCAPTCHA, with `data-sitekey` attribute set
- Have a service receive the request sent from the page
- Add a call to Google's service to check whether that information reCAPTCHA
  sent is valid, and if it is a bot or not.

There is a more complete documentation [here](https://www.google.com/recaptcha).
It is not too lengthy nor complicated. Take 10 or 15 minutes to take a look,
you won't regret it.

## Quick and dirty

### 1. Add reCAPTCHA script and add a callback function

```html
  <script src="https://www.google.com/recaptcha/api.js"></script>
  <script type="text/javascript">
    function submitForm(token) {
      document.getElementById("SampleRegistrationForm").submit();

    }
  </script>
```

Really simple. This code defined a function `submitForm` which will take
whatever element `SampleRegistrationForm` contains and submit it. The server
(for this example) is defined in the form itself.

### 2. Add a button

```html
  <form action="http://localhost:3000/users" method="POST" id="SampleRegistrationForm">
    ...
    <button class="g-recaptcha" 
        data-sitekey="YOUR SITE KEY HERE" 
        data-callback='submitForm' 
        data-action='submit'>Submit</button>
  </form>
```

This will create a form and will add a button to it. Notice the `YOUR SITE KEY HERE`
attribute. This should be, ahm, your site key. "But I don't want to use my
site keys just yet, I'm just tinkering around", you might say. Fret not, for
there are sample keys you can use [here](https://developers.google.com/recaptcha/docs/faq#id-like-to-run-automated-tests-with-recaptcha.-what-should-i-do). Keep in
mind that these keys will not block anything. They are permissive. Bots are
welcomed here.

When you are ready to take the next step, create your own keys [here](https://www.google.com/recaptcha/admin/create).

### 3. Add reCAPTCHA verification to your backend
  
This is simpler than it sound. Basically, send a POST HTTP request to `https://www.google.com/recaptcha/api/siteverify` with data received from the request (by default it should be
`g-recaptcha-response`, but it can have another names. It should be the
token generated by reCAPTCHA library) and your secret key (which you got when
you created the site key). This request should look like this (I'm using axios
here):

```javascript
  const config = {
    method: 'post',
    url: 'https://www.google.com/recaptcha/api/siteverify',
    // These are querystring parameters!
    params: {
      secret: process.env.GOOGLE_CAPTCHA_KEY,
      response: req.body["g-recaptcha-response"]
    }
  }
  console.log(`Request data: ${util.inspect(config)}`)
  axios(config).then((status) => {
    console.log(`Received response from Google: ${util.inspect(status.data)}`);
    if (data.success === true) {
      res.status(200).send({'message': 'ok'});
    } else {
      res.status(405).send({'message': 'not-allowed'});
    }
  }).catch((error) => {
    console.log(`Received error from Google: ${error}`);
    res.status(500).send({'message': 'error'});
  });
```

Notice that the response contains an attribute `success` which should be the
trigger to let the request be processed (`true` indicates that the service
thinks that the user is a human - poor thing -, `false` it should be a bot).

## In finis

*And that's it*. Really. That simple. Complex things into wonderfully designed
interfaces.

That's the end of our tutorial. Sample codes are available here. Enjoy!

#StayHome
